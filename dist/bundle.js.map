{"version":3,"file":"bundle.js","mappings":"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","sources":["webpack://senler-integration-bot/webpack/bootstrap","webpack://senler-integration-bot/webpack/runtime/make namespace object","webpack://senler-integration-bot/./src/index.js"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// define __esModule on exports\n__webpack_require__.r = function(exports) {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","class IntegrationConnect {\r\n\r\n\r\n    constructor() {\r\n\r\n        this.requests = {};\r\n        this.subscribers = [];\r\n        this.timeout_sec = 50;\r\n\r\n        let onmessage = (e) => {\r\n            // if (!this.isValidSource(e.origin, this.currIntegration.url_callback)){\r\n            //     alert('Запрос с интеграции не корректен');\r\n            //     return false;\r\n            // }\r\n            console.log('integration .onmessage ', 'e.origin=', e.origin, e.data);\r\n\r\n            let message = e.data;\r\n\r\n            if (message.hasOwnProperty('request') && message.hasOwnProperty('response')) {//full\r\n                this.handleResponse(message);\r\n            } else {\r\n                if (message.hasOwnProperty('request')) {\r\n                    this.handleRequest(message);\r\n                }\r\n            }\r\n        };\r\n\r\n        if (window.addEventListener) {\r\n            window.addEventListener('message', onmessage, false);\r\n        } else if (window.attachEvent) {\r\n            window.attachEvent('onmessage', onmessage);\r\n        }\r\n\r\n        setInterval(() => {\r\n            let time = new Date().getTime();\r\n\r\n            for (let id in this.requests) {\r\n                if (this.requests.hasOwnProperty(id)) {\r\n                    let request = this.requests[id];\r\n                    if (time > (request.time + (this.timeout_sec * 1000))) {\r\n                        request['response'] = {success: false, payload: {}, message: \"timeout\", code: 1000};\r\n                        console.log('timeout request=', request);\r\n                        this.handleResponse(request);\r\n                    }\r\n                }\r\n            }\r\n        }, 5000);\r\n    }\r\n\r\n    route(type, callback) {\r\n        this.subscribers.push({type: type, callback: callback});\r\n    }\r\n\r\n    send() {\r\n        console.log('.send', this);\r\n        window.parent.postMessage(JSON.parse(JSON.stringify(this)), '*');\r\n    }\r\n\r\n\r\n    handleRequest(message) {\r\n\r\n        console.log('integration .handleRequest', message);\r\n        let response = {success: true, payload: {}};\r\n\r\n        message.send = this.send;\r\n        message.response = response;\r\n\r\n\r\n        try {\r\n\r\n            for (let subscriber of this.subscribers) {\r\n                if (subscriber.type === message.request.type) {\r\n                    subscriber.callback(message);\r\n                }\r\n            }\r\n        } catch (e) {\r\n            response.success = false;\r\n            response.error = e.message;\r\n        }\r\n        message.response = response;\r\n\r\n        // window.parent.postMessage(JSON.parse(JSON.stringify(message)), '*');\r\n    }\r\n\r\n    handleResponse(message) {\r\n        console.log('integration .handleResponse message=', message);\r\n        if (message.id && this.requests.hasOwnProperty(message.id)) {\r\n\r\n            let request = this.requests[message.id];\r\n            request.callback(message.response);\r\n            delete this.requests[message.id];\r\n        } else {\r\n            console.log('.handleResponse');\r\n        }\r\n    }\r\n\r\n    sendRequest(_message, callback = () => {\r\n    }) {\r\n\r\n        try {\r\n            let id = (new Date()).getTime();\r\n\r\n            let message = {};\r\n            message.id = id;\r\n            message.callback = callback;\r\n            message.request = _message;\r\n\r\n            this.requests[id] = message;\r\n\r\n            console.log('integration sendRequest ', message);\r\n            window.parent.postMessage(JSON.parse(JSON.stringify(message)), '*');\r\n\r\n        } catch (e) {\r\n            console.log('.sendRequest', e);\r\n        }\r\n\r\n    }\r\n\r\n    isValidSource(url_source, url_integration) {\r\n        return this.getHost(url_source) === this.getHost(url_integration);\r\n    }\r\n\r\n\r\n    getHost(url) {\r\n        let a = document.createElement('a');\r\n        a.href = url;\r\n        return a.hostname\r\n    }\r\n\r\n\r\n}\r\n\r\nexport default IntegrationConnect\r\n\r\n"],"names":["IntegrationConnect","requests","subscribers","timeout_sec","onmessage","e","console","log","origin","data","message","hasOwnProperty","handleResponse","handleRequest","window","addEventListener","attachEvent","setInterval","time","Date","getTime","id","request","success","payload","code","type","callback","push","parent","postMessage","JSON","parse","stringify","response","send","subscriber","error","_message","url_source","url_integration","getHost","url","a","document","createElement","href","hostname"],"sourceRoot":""}